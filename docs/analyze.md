## 機能要件

### 認証・認可
- Supabase Auth（メール／パスワード＋OAuth）、RLSによるグループ隔離  
- CIパイプラインでRLSポリシーテスト自動実行  
- レート制限：ユーザー60req/分、グループ200req/分  

### グループ管理
- グループ作成・参加・メンバー招待・削除  
- オーナー／メンバーごとの権限分離  
- ウィザード形式UI、ARIA属性・スクリーンリーダー対応  

### レシート管理
- プライベートSupabase Storage（`receipts`バケット）  
- `receipts`テーブル＋OCRキャッシュ＋監査ログテーブル  
- 操作履歴を`receipt_audit_logs`に記録  

### OCR処理
- Supabase Edge Function（Deno＋tesseract.js）  
- 画像前処理：リサイズ・グレースケール・二値化  
- 認識失敗時に手動入力フォーム表示  
- OpenAI APIによる構造化パース併用検討  
- パフォーマンスSLO：OCR p95 2秒以内  

### 割り勘計算・結果表示
- 人数入力＋四捨五入／切り上げ／切り捨て  
- 合計・日付・店舗名を優先表示、その他は折りたたみ  
- OCRテキスト・金額の手動修正  

### リアルタイム同期・競合対策
- Supabase Realtime  
- `version`カラムによる楽観的ロック＋マージUI  

### 通知機能
- プッシュ／メール通知  
- 即時／日次まとめ／通知オフ時間帯設定  
- 法令準拠テンプレート  

---

## 非機能要件

### スケーラビリティ・パフォーマンス
- 同時実行数メトリクスをCloud Logsで可視化  
- 高負荷時はジョブキューへフォールバック  
- CDNキャッシュ適用  
- パフォーマンス予算：フロントロード1秒以内、API p95 500ms  

### 可用性・監視・観測性
- OCRエラー・タイムアウトをSlack通知  
- 定期レポート：OCR正常率、RLSテスト結果、稼働率  
- 分散トレーシング実装、ログ30日保持  

### 災害復旧
- DBバックアップ24h毎  
- RTO: 2時間、RPO: 1時間  

### リリース管理
- 自動マイグレーション&段階的ロールアウト  
- フィーチャーフラグ対応  

### セキュリティ・プライバシー
- データ暗号化（保存時・転送時）、鍵管理はSupabase管理  
- 画像24h自動削除オプション  
- OCRテキストの店舗名・日時マスキング  
- SOC2取得予定、ISO27001計画中  

### コスト最適化 & 分析
- OCRキャッシュで再処理を防止  
- 古いレシートのアーカイブ＆圧縮  
- 利用分析：処理件数、アクティブグループ／ユーザー計測  

### 法令・規制
- メール文面は特定電子メール法準拠  
- 利用規約・プライバシーポリシーにデータ保持期間・共有範囲明示  

### アクセシビリティ
- キーボード操作・フォーカス移動テスト済  
- ARIA Live Regionで動的更新通知  

### 国際化
- 対応言語：日本語、英語  
- 日付表示はロケールに準拠  

### オフライン対応
- PWA対応、レシート・設定をローカルキャッシュ  

### 開発者体験
- APIモック機能  
- ローカル環境スナップショット  
- GitHub ActionsによるCI/CD  

### ユーザーフィードバック
- アプリ内フィードバックウィジェット  
- サポート窓口: support@example.com  
